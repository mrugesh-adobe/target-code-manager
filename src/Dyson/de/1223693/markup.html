<div __recsClickTrackIdPlaceholder__><div __recsClickTrackIdPlaceholder__><script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick.min.js" integrity="sha512-HGOnQO9+SP1V92SrtZfjqxxtLmVzqZpjFFekvzZVWoiASSQgSr4cw9Kqd2+l8Llp4Gm0G8GIFJ4ddwZilcdb8A==" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick.min.css" integrity="sha512-yHknP1/AwR+yx26cB1y0cjvQUMvEa2PFzt1c9LlS4pRQ5NOTZFWbhBig+X9G9eYW/8m0/4OXNx8pxJ6z57x0dw==" crossorigin="anonymous"/>
<style type="text/css" id='recs_style_T472'>
.recs-container-T817 .at_recs_price .trade-up-item__reduced-price{
	text-decoration: line-through;
	font-size: .875rem;
	display: inline-flex;
}
.recs-container-T817 .at_recs_price .trade-up-item__reduced-price .curr_before, .at_recs_price .trade-up-item__savings .curr_before{
	padding-left: 4px;
}
.recs-container-T817 .at_recs_price .trade-up-item__savings {
	color: #06c;
	font-size: .875rem;
	display: inline-flex;
	padding-left: 4px;
}
.recs-container-T817 a.at_recs_card:hover {
	border: 1px solid #333;
}
.recs-container-T817 .custom-badge.none {
	visibility: hidden;
}

.recs-container-T817 .custom-badge.US_only_at,
.recs-container-T817 .custom-badge.global_offer_promo {
	background-color: #0066cc;
}
.recs-container-T817 .custom-badge.us_exclusive {
	background-color: #333;
}
.recs-container-T817 .custom-badge.us_urgency {
	background-color: #d9384e;
}
.recs-container-T817 .custom-badge.us_technology {
	background-color: #000;
}
.recs-container-T817 .at-table {
	display: flex;
	width: 100%;
	border-spacing: 5px;
}
.recs-container-T817 .at-table-row {
	width: 100%;
	clear: both;
}
.recs-container-T817 .at-table-column {
	float: left;
	display: flex;
	flex-direction: column;
	flex: 0 0 auto;
	padding: 16px;
}
.recs-container-T817 {
	padding-bottom: 1rem;
	background: #fcfcfc;
}
.recs-container-T817 .recs_wrapper {
	margin: 0;
	padding: 0;
}
.recs-container-T817 .image_container {
	position: relative;
}
.recs-container-T817 .text_section>h3 {
	margin-bottom: 0;
	padding-bottom: 0 !important;
	padding-top: 0;
}
.recs-container-T817 .full_width {
	width: 100% !important;
}
.recs-container-T817 .at_recs_price.trade-up-item__regional>button {
	padding: 0;
}
.recs-container-T817 .at_recs_card {
	border: 1px solid #dadada;
	background-color: #ffffff;
	text-decoration: none !important;
	display: inline-block;
	width: 100%;
	position: relative;
}
.recs-container-T817 .at_recs_card .trade-up-item__badge {
	z-index: 1;
}
.recs-container-T817 .mobile_badge,
.recs-container-T817 .mobile_only_line {
	display: none;
}
.recs-container-T817 .at_recs_card .reviews_section {
	padding: 8px 10px 0px 15px;
}

.recs-container-T817 .review_stars {
	width: 96px;
	min-height: 18px;
	display: inline-block;
	vertical-align: middle;
	background-position-x: 100%;
	background-repeat: no-repeat;
	background-size: cover;
	background-image: url(https://www.dyson.co.uk/content/dam/dyson/adobetarget/recommendations/review-stars-small-new.png);
	margin-right: 8px;
}
.recs-container-T817 .review_stars.five {
	background-position-y: 0;
}
.recs-container-T817 .review_stars.four-five {
	background-position-y: 10%;
}
.recs-container-T817 .review_stars.four {
	background-position-y: 20%;
}
.recs-container-T817 .review_stars.three-five {
	background-position-y: 30%;
}
.recs-container-T817 .review_stars.three {
	background-position-y: 40%;
}
.recs-container-T817 .review_stars.two {
	background-position-y: 60%;
}
.recs-container-T817 .review_stars.two-five {
	background-position-y: 50%;
}
.recs-container-T817 .review_stars.one-five {
	background-position-y: 70%;
}
.recs-container-T817 .review_stars.one {
	background-position-y: 80%;
}
.recs-container-T817 .review_stars.zero {
	background-position-y: 100%;
}
.recs-container-T817 .review_stars.invisible,
.recs-container-T817 .review_stars.invisible+.review_text {
	visibility: hidden;
	opacity: 0;
}
.recs-container-T817 .review_text {
	vertical-align: middle;
	display: inline-block;
}

@media screen and (max-width: 767px) {
	.recs-container-T817 .at_recs_card {
		display: flex;
	}
	.recs-container-T817 {
		border-bottom: 1px solid #dadada;
	}
}
.recs-container-T817 .at_recs_price {
	flex-direction: column;
	justify-content: center;
	padding-top: 8px;
	padding-bottom: 8px;
}
.recs-container-T817 .custom-badge {
	color: white;
	background: black;
	top: -13px;
	left: 16px;
	margin-left: 8px;
	z-index: 3 !important;
	position: absolute;
	padding: 2px 8px;
	font-size: 0.875rem;
	font-weight: 500;
}
.custom-badge.be_promotions,
.custom-badge.nl_promotions,
.custom-badge.de_promotions
.fr_PromotionBadgeTheme{
	color: #0066cc !important;
	background-color: #ffffff !important;
	box-shadow: inset 0px 0px 0px 1px #0066cc;
}
.recs-container-T817 .custom-badge.be_direct_exclusive {
	color: #fff !important;
	background-color: #0066CC !important;
}
.recs-container-T817 .custom-badge.be_latest_technology {
	color: #fff !important;
	background-color: #000 !important;
}

@media(max-width: 480px) {
	.recs-container-T817 .at_recs_card>.image_container>.at-thumbnail {
		max-height: 220px;
		width: auto;
	}
	.recs-container-T817 .at_recs_card>.text_section>h3,
	.recs-container-T817 .at_recs_card>.text_section>.at_recs_price>div.trade-up-item__price--blue>.price,
	.recs-container-T817 .trade-up-item__price {
		font-size: 16px;
		font-weight: 500;
		color: #333;
	}
	.recs-container-T817 .at-table-column {
		padding-top: 0;
		padding-bottom: 0;
		max-width: 60%;
		margin-bottom: 20px;
	}
	.recs-container-T817 .at_recs_card {
		border: none;
	}
	.recs-container-T817 .at_recs_card .text_section {
		display: flex;
		flex-direction: column;
		flex-wrap: nowrap;
		align-items: flex-start;
	}
	.recs-container-T817 .mobile_only_line {
		display: inline-block;
		width: 114%;
		position: absolute;
		top: 0;
		margin-left: -12%;
	}
	.recs-container-T817 .custom-badge {
		display: inline-block;
		margin-top: 0;
		margin-left: 1rem;
		position: absolute;
		top: -10px;
		left: 0;
		margin-bottom: 8px;
		order: -1;
		padding: 3px;
	}
	.recs-container-T817 .carousel button:focus {
		outline: none !important;
	}
	.recs-container-T817 .at_recs_card>.badge {
		display: none;
	}
	.recs-container-T817 .mobile_badge {
		display: inline-block;
		margin-top: 1rem;
		margin-left: 1rem;
		position: relative;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		margin-bottom: 8px;
	}
	.recs-container-T817 .at_recs_card .reviews_section {
		padding: 8px 10px 0px 15px;
	}
	.recs-container-T817 .review_stars {
		width: 92px;
		min-height: 16px;
	}
}
.recs-container-T817 div.trade-up-item__price--blue {
	color: #06c;
	font-size: 24px;
	font-weight: 500;
}

@media screen and (min-width: 481px) and (max-width: 1024px) {
	.recs-container-T817 .at_recs_card>.image_container {
		display: flex;
		justify-content: center;
		align-items: flex-start;
	}
	.recs-container-T817 .at_recs_card>.image_container>.at-thumbnail {
		width:auto;
		height:220px;
		margin-top: 1px;
	}
	.recs-container-T817 .at_recs_card>.text_section>h3,
	.recs-container-T817 .at_recs_card>.text_section>.at_recs_price>div.trade-up-item__price--blue>.price,
	.recs-container-T817 .trade-up-item__price {
		font-size: 16px;
		font-weight: 500;
		color: #333;
	}
	.recs-container-T817 .at-table-column {
		padding: 16px 11px;
	}
	.recs-container-T817 .custom-badge {
		left: 11px;
	}
}
@media screen and (min-width: 1025px) {
	.recs-container-T817 .at_recs_card>.image_container {
		display: flex;
		justify-content: center;
	}
	.recs-container-T817 .at_recs_card>.image_container>.at-thumbnail {
		margin-top: 1px;
		max-height: 240px;
		width: auto;
	}
	.recs-container-T817 .at_recs_card .text_section>h3,
	.recs-container-T817 .at_recs_card .text_section>.at_recs_price>div.trade-up-item__price--blue>.price,
	.recs-container-T817 .trade-up-item__price {
		font-size: 18px;
		font-weight: 500;
		color: #333;
	}
	.recs-container-T817 .carousel {
		margin:0 auto !important;
	}
}
.recs-container-T817 .see-more-section {
	padding: 0px !important;
}
.recs-container-T817 .promoText-section {
	color: #06c;
}

.gb_exclusive,.us_exclusive,.ca_exclusive {
	background-color: #333;
	color: #fff;
}
.gb_urgency,.us_urgency,.ca_urgency {
	background-color: #d9384e;
	color: #fff;
}
.gb_educational,.us_educational,.ca_educational {
	background-color: #fff;
	color: #333;
}
.gb_offer_promo,.us_offer_promo,.ca_offer_promo {
	background-color: #0066cc;
	color: #fff;
}
.gb_popular,.us_popular,.ca_popular {
	background-color: #ffcc00;
	color: #000;
}
.gb_technology,.us_technology,.ca_technology {
	background-color: #000;
	color: #fff;
}
.fr_exclusive,.nl_exclusive,.ie_exclusive,.it_exclusive,.es_exclusive,.at_exclusive,.de_exclusive {
	background-color: #333;
	color: #fff;
}
.fr_urgency,.nl_urgency,.ie_urgency,.it_urgency,.es_urgency,.at_urgency,.de_urgency {
	background-color: #d9384e;
	color: #fff;
}
.fr_educational,.nl_educational,.ie_educational,.it_educational,.es_educational,.at_educational,.de_educational {
	background-color: #fff;
	color: #333;
}
.fr_offer_promo,.nl_offer_promo,.ie_offer_promo,.it_offer_promo,.es_offer_promo,.at_offer_promo,.de_offer_promo {
	background-color: #0066cc;
	color: #fff;
}
.fr_popular,.nl_popular,.ie_popular,.it_popular,.es_popular,.at_popular,.de_popular {
	background-color: #ffcc00;
	color: #000;
}
.fr_technology,.nl_technology,.ie_technology,.it_technology,.es_technology,.at_technology,.de_technology {
	background-color: #000;
	color: #fff;
}
.recs-container-T817 .recs_wrapper.carousel{
    width:100%;
    margin:0px;
    visibility: visible;
    display: inline-flex;
}
.recs-container-T817 .recs_wrapper .slick-slide{
  margin:10px;
}
.recs-container-T817 .recs_wrapper .slick-slide img{
  width:100%;
  border: 2px solid #fff;
}
.recs-container-T817 .recs_wrapper .wrapper .slick-dots li button:before {
  font-size:20px;
  color:white;
}
	 @media screen and (max-width: 500px) {
		.recs-container-T817 .recs_wrapper.carousel.slick-initialized.slick-slider {
		position: relative;
		display: flex;
		box-sizing: border-box;
		} 
		.recs-container-T817 .recs_wrapper.carousel a.at_recs_card {
			display: block !important;
			 border: 1px solid #dadada;
			background-color: #ffffff;
			text-decoration: none !important;
			display: inline-block;
			width: 100%;
			padding: 0;
			position: relative;
		}
		.recs-container-T817 .at_recs_card>.image_container {
			display: flex;
			justify-content: center;
			
		}
		  .recs-container-T817 .recs_wrapper .slick-slide .at-table-column {
			  padding: 0;
		  }
		  .recs-container-T817 .at_recs_price.trade-up-item__regional {
			  width: 100% !important;
		  }
		  .recs-container-T817 div.trade-up-item__price--blue {
				padding-bottom: 10px;
			}
			.recs-container-T817 a.at_recs_card:hover, a.at_recs_card:focus, a.at_recs_card:active {
				border: 1px solid #333;
				color: #333;
				outline: none;
			}
			.recs-container-T817 .recs-container .row {
				width: 100% !important;
				margin-left: 25px !important;
			}
	 }
	.recs-container-T817 .recs_wrapper .slick-list{padding:0 40% 0 0 !important; }
	.recs-container-T817 .recs_wrapper .slick-prev, .recs-container .slick-next {
		font-size: 0;
		line-height: 0;
		position: absolute;
		top: 47%;
		display: block;
		width: 35px;
		height: 35px;
		padding: 0;
		margin-top: -10px \9;
		-webkit-transform: translate(0, -50%);
		-ms-transform: translate(0, -50%);
		transform: translate(0, -50%);
		cursor: pointer;
		color: transparent;
		border: none;
		border-radius: 17px;
		background: #a7a4a4;
	 }
	.recs-container-T817 .recs_wrapper .slick-next {
		left: 83%;
	 }
	.recs-container-T817 .recs_wrapper .slick-prev {
		 z-index: 99;
		 right: 86%;
	 }
	.recs-container-T817 .recs_wrapper .slick-next:before {
		content: '→';
		transform: rotate(-45deg);
		-webkit-transform: rotate(-45deg);
		left: -2px;
		font-size: 0;
	}
	.recs-container-T817 .recs_wrapper .slick-prev:before {
		content: '←';
		 transform: rotate(135deg);
		-webkit-transform: rotate(135deg);
		right: -3px;
		font-size: 0;
	}
	.recs-container-T817 .recs_wrapper .slick-prev:before, .recs-container .slick-next:before {
		 color: white;
		 -webkit-font-smoothing: antialiased; 
		border: solid white;
		border-width: 0 5px 5px 0;
		display: inline-block;
		padding: 5px;
		box-shadow: 1px 1px 0px rgba(0, 0, 0, 0.1);
		position: relative;
	}
	.recs-container-T817 .recs_wrapper .slick-disabled {
		opacity: 0;
		pointer-events: none;
	}
	.recs-container-T817 .recs_wrapper .slick-track {
		display: flex !important;
	}
	.recs-container-T817 .recs_wrapper .slick-slide
	{
		height: inherit !important;
	}
	.recs-container-T817 .trade-up-item__price {
		border-top: 1px solid #dadada;
		padding-left: 15px;
		padding-top: 10px;
		font-size: 24px;
	}
	.recs-container-T817 .trade-up-item__text.trade-up-item__name {
		line-height: 1.3;
		padding-right: 10px;
	}
	 @media screen and (min-width: 768px) and (max-width: 1024px) {
		.recs-container-T817 .recs_wrapper.carousel {
			margin: 0 auto !important;
		 }
		.recs-container-T817 .recs_wrapper.carousel li:nth-child(4) {
			 display: none;
		 }
		.recs-container-T817 .at-table-column.col-xs-12.col-md-3 {
			 width: 33.33%
		 }
	 }
	.recs-container-T817 .review_text {
		 font-size: 0.875rem;
	 }
	.recs-container-T817 .trade-up-item__price--blue, .trade-up-item__reduced-price, .trade-up-item__text {
		 padding-left: 15px;
	 }
	.recs-container-T817 .recs_wrapper #chevron-bold-sr {
		 display: none !important;
	 }
	.recs-container-T817 .recs_wrapper .slick-track:after, .slick-track:before {
		 display: none;
	 }
	.recs-container-T817 .at_recs_card .js-product-hero-promo-message {
	margin-top: 0;
	padding-left: 15px;
	padding-right: 15px;
	margin-bottom: .5rem;
}
.recs-container-T817 .at_recs_card .js-product-hero-promo-message ul.list {
	padding-left: 0;
}
.recs-container-T817 .at_recs_card .js-product-hero-promo-message .js-promotional-details-message {
	list-style-type: none;
    color: #06c;
}
.recs-container-T817 .at_recs_card .js-product-hero-promo-message li strong {
	overflow: hidden;
   text-overflow: ellipsis;
   display: -webkit-box;
   -webkit-line-clamp: 2; 
           line-clamp: 2;
   -webkit-box-orient: vertical;
       font-weight:400!important;
}
</style>

<script type="text/template" id="at_template_recs_T817">
  <div class="recs-container-T817" data-analytics-component="product-recommendations" >
     #if($entities.size() > 0)
         <div class="container-fluid container-fluid--upto-lg pt-lg-0 pt-xl-0 pb-lg-0 pb-xl-0 pt-md-0 pb-md-0 pt-xs-0 pt-sm-0 pb-xs-0 pb-sm-0">
             <div class="row">
                 <div class="at-table">
                     <div class="at-table-row">
                         <h2 class="trade-up-header__content js-trade-up-header-content col-xs-12"></h2>
                         <ul class="recs_wrapper carousel">
                         #set($count = 1)
                         #set($base_url="https://dyson-h.assetsadobe2.com/is/image/content/dam/dyson/images/products/primary/SKU.png")
                         #foreach($e in $entities)
                             #set($id = $e.id)
                             #set($sapDivision = $e.sapDivision)
                             #set($mainCategory = $e.categoryMain)
                             #set($lang="${mbox.page_lang}")
                             #if($lang != '')
                             #set($newURL = 'pageURL_'+$lang)
                             #set($pageURL = $e.get($newURL))
                             #else
                             #set($pageURL = $e.pageURL)
                             #end
							 
                             #if($lang != '')
							 #set($newBadge = 'badgeText_'+$lang)
                             #set($badge = $e.get($newBadge))
                             #else
                             #set($badge = $e.badgeText)
                             #end
                             #set($badgeClass=$e.badgeTheme)
							 #set($newlname = 'name' + $lang)
                             #set($lname = $e.get($newlname))
                             #set($domain = $e.domain)
							 #if($lang != '')
							 #set($newprodPromoMessage = 'prodPromoMessage_'+$lang)
                             #set($prdtMessage = $e.get($newprodPromoMessage))
                             #else
                             #set($prdtMessage = $e.prodPromoMessage)
                             #end
                             #if(!$pageURL || $pageURL == "")
                                 #set($pageURL=$e.pageURL)
                                 #end
                                 #if($lname == "")
                                 #set($lname = $e.localName)
                             #end
							 #if($e.domain == "at")
                                #set($rCount=$e.reviewCount)
                             #end
							 #if($e.domain == "at")
								#set($rStar=$e.reviewStar)
                             #end
                             #if(!$badge || $badge == "")
                                 #set($badge=$e.badgeText)
                             #end
                             #if($lang == 'en' && $e.localName !="" )
                                 #set($lname = $e.localName)
                             #end
							 
                             #if($count < 5 && $id != '' && $lname.indexOf('Airblade') < 0)
                                 #set($count = $count + 1)
                                 <li class="at-table-column col-xs-12 col-md-3 col-lg-3" data-analytics-action-title="$lname">
                                     <span role="group" aria-label="Product">
                                     <a class="at_recs_card" data-analytics-action-name="see more" 
                                     href="$pageURL" sku="$e.id.replace('US', '').replace('JP', '')" region="$e.domain" category="$mainCategory">
                                         
                                         <span class="mobile_only_line"></span>
                                         
                                         <div class="image_container">
                                            #set($img_url=$base_url.replace("SKU", $id.replace("GB", "").replace("FR", "").replace("US", "").replace("CA", "").replace("DE", "").replace("CH", "").replace("ES", "").replace("IT", "").replace("BE", "").replace("PT", "").replace("DK", "").replace("NO", "").replace("SE", "").replace("FI", "").replace("NL", "").replace("IE", "").replace("AT", "").replace("JP", "")))
                                             <img alt="" src="$img_url" class="at-thumbnail"/>
                                         </div>
                                         <div class="text_section">
                                             <h3 class="trade-up-item__text trade-up-item__name">$lname</h3>
											#if($badge != '')
                                             <span class="badge trade-up-item__badge custom-badge $badgeClass">$badge</span>
										    #end
											#if($e.domain == "at")
                                                 <div class="trade-up-item__text reviews_section">
												<span class="review_stars">$e.reviewStar</span>
												<div class="sr-only ratings__stars--reader"></div> 
												<span class="review_text">$e.reviewCount</span>
												</div>
											#else
												<div class="trade-up-item__text reviews_section">
												<span class="review_stars"></span>
												<div class="sr-only ratings__stars--reader"></div> 
												<span class="review_text"></span>
												</div>
                                            #end                                             
											 #set($newfullPrice='wasPrice_' + $lang) 
                                             #set($fullPrice=$e.get($newfullPrice)) 
											 #set($newsalePrice='currPrice_' + $lang) 
                                             #set($salePrice=$e.get($newsalePrice))
											 #set($newdiff='savePrice_'+$lang)
                                             #set($diff=$e.get($newdiff))
											 #set($discount=$e.discountText)
                                             #set($curr='&#36;')
                                             #if($e.domain == "uk")
                                             #set($curr='&pound;')
                                             #end

                                             #if($e.domain == "ch")
                                             #set($curr="CHF ")
                                             #end
<!--change SM : adding currency for Sweden -->
                                                 #if($e.domain == "se")
                                                 #set($curr=" kr ")
                                             #end
<!--change SM : adding currency for Norway -->
                                                 #if($e.domain == "no")
                                                 #set($curr=" kr ")
                                             #end
<!--change SM : adding currency for Denmark -->
                                                 #if($e.domain == "dk")
                                                 #set($curr=" kr ")
                                             #end
												 #if($e.domain == "jp")
												 #set($curr="&#165;")
											 #end
                                             #if($e.domain == "fr" || $e.domain == "de" || $e.domain == "es" || $e.domain == "it" || $e.domain == "be" || $e.domain == "nl" || $e.domain == "pt" || $e.domain == "fi" || $e.domain == "ie" || $e.domain == "at" )
                                                 #set($curr='&euro;')
                                             #end
                                             <div class="at_recs_price trade-up-item__regional">
                                                 #if($salePrice=="")
                                                     <div class="trade-up-item__price">
                                                        <span class="curr_before"></span><span class="price">$fullPrice</span></div>
                                                 #else
                                                 <div class="atBluePrice">
													 <div class="trade-up-item__price--blue trade-up-item__price"><span class="price">$salePrice</span>
                                                     </div>
													 #if($discount == "A")
														 <div class="trade-up-item__reduced-price"><span class="curr_before">$fullPrice</span>
														 </div>
														 <div class="trade-up-item__savings js-item-savings"><span class="curr_before">$diff</span>
														 </div>
													 #end
                                                </div>
                                                 #end
                                             </div>
											 <div class="product-hero__promotion--messages product-hero__promotion-no-padding js-product-hero-promo-message ">
                                                <ul class="list"><li class="element js-promotional-details-message" data-promotion-type="OTHER"><strong>$prdtMessage</strong>
												</li></ul>
                                            </div>
                                             <button class="trade-up-item__regional see-more-section button button--transactional js-add-to-basket-button promotional-hero__button add-to-basket__form-button">
                                                 <span>Shop now</span>
                                             </button>
                                         </div>
                                     </a>
                                     </span>
                                 </li>
                             #end
                         #end
 
                         </ul>
                     </div>
                 </div>
             </div>
         </div>
     #end
     </div>
    </script>
	 <script type="text/javascript">
    /*!
     * flickerlessly.js v0.2.1
     * @author Vadym Ustymenko
     * @copyright 1996-2019. Adobe Systems Incorporated. All rights reserved.
     * @usage: Flickerlessly.onReady({selector:'.a, .b', success:function(el, log){}},
     *                              {selector:'.c', success:myCallbackFn, persist:true });
     */
	 
	     var addPriceHeight = function () {
        if (!document.querySelector('.at_recs_price.trade-up-item__regional[reduced]')) {
            return;
        }
        if (!document.getElementById('reduced_price_style')) {
            document.body.insertAdjacentHTML('afterbegin', '<style id="reduced_price_style"></style>');
        }
        
    },
        matchHeight = function () {
            /*name height*/
            var names = document.querySelectorAll('.at_recs_card .trade-up-item__text.trade-up-item__name'), reviews = document.querySelectorAll('.at_recs_card .text_section .trade-up-item__text.reviews_section'), priceSection=document.querySelectorAll('.at_recs_price.trade-up-item__regional'),promoSection=document.querySelectorAll('.at_recs_card .js-product-hero-promo-message'), max = 0;
            if (jQuery(window).width() < 100) {
                for (var i = names.length - 1; i >= 0; i--) {
                    names[i].style.minHeight = max;
                }
                for (var i = reviews.length - 1; i >= 0; i--) {
                    reviews[i].style.minHeight = max;
                }
            } else {
                for (var i = names.length - 1; i >= 0; i--) {
                    max = names[i].offsetHeight > max ? names[i].offsetHeight : max;
                }
                for (var i = names.length - 1; i >= 0; i--) {
                    names[i].style.minHeight = max + 'px';
                }
                max = 0;
                for (var i = reviews.length - 1; i >= 0; i--) {
                    max = reviews[i].offsetHeight > max ? reviews[i].offsetHeight : max;
                }
                for (var i = reviews.length - 1; i >= 0; i--) {
                    reviews[i].style.minHeight = max + 'px';
                }
				max = 0;
                for (var i = priceSection.length - 1; i >= 0; i--) {
                    max = priceSection[i].offsetHeight > max ? priceSection[i].offsetHeight : max;
                }
                for (var i = priceSection.length - 1; i >= 0; i--) {
                    priceSection[i].style.minHeight = max + 'px';
                }
				max = 0;
                for (var i = promoSection.length - 1; i >= 0; i--) {
                    max = promoSection[i].offsetHeight > max ? promoSection[i].offsetHeight : max;
                }
                for (var i = promoSection.length - 1; i >= 0; i--) {
                    promoSection[i].style.minHeight = max + 'px';
                }
            }
        },
		loadCarousel = function() {
			if ((typeof (jQuery) != 'undefined' &&
							typeof jQuery.fn.slick !== "undefined") && !document.querySelector('.recs_wrapper .slick-next.slick-arrow')) {
					var jq = jQuery.noConflict();
					if(window.innerWidth < 500){
						setTimeout(function(){
							jq('.recs_wrapper.carousel').slick({
						  slidesToShow: 1,
						  dots:false,
						  centerMode: false,
							infinite: false,
							slidesToScroll: 1
						  });
						  document.querySelectorAll('.at-table-column').forEach(function(i){
							  i.style.maxWidth='100%';
						  });
						  clearInterval(loadCarousel);
						  document.querySelector('.recs_wrapper.carousel').style.visibility = 'visible';
						},500);
						setTimeout(function () {
							matchHeight();
							addPriceHeight();
						}, 500);
					} 
							}
							
							if(window.innerWidth > 500){
						document.querySelector('.recs_wrapper.carousel').style.visibility = 'visible';
						 setTimeout(function () {
							matchHeight();
							addPriceHeight();
						}, 500);
					}
		}
		
    window.addEventListener('load', function () {
        setTimeout(function () {
            matchHeight();
            addPriceHeight();
        }, 2500);
        setTimeout(function () {
            matchHeight();
            addPriceHeight();
        }, 2500);
        setTimeout(function () {
            matchHeight();
            addPriceHeight();
        }, 2500);
    })
    window.addEventListener('resize', function () {
        setTimeout(function () {
            matchHeight();
            addPriceHeight();
        }, 2500);
    });
	
	
    window._dtag = '', window._lang = '',
        header = 'Featured',
        header1 = ' products',
        see_more = 'Shop now',
        reviewLang = 'Reviews',
        oosLocal = '',
        recommendedPrefix = 'Recommended';
        recommendedSuffix = 'for you';
        categoryValues = {
            "vacuum cleaners" : "vacuum cleaners",
            "personal care" : "hair care",
            "air treatment" : "air treatment",
            "wearables" : "headphones",
            "lightning" : "lightning",
            "floor cleaners" : "vacuum cleaners"
          };
    
    if (location.host.indexOf('.de') > -1) {
        _dtag = 'de';
        header = 'Unsere Bestseller für dich';
        header1 = '';
        see_more = 'Mehr erfahren';
        reviewLang = 'Bewertungen';
        oosLocal = ' ';
        recommendedPrefix = 'Empfohlene';
        recommendedSuffix = 'für dich';
        categoryValues = {
            "vacuum cleaners" : "Staubsauger",
            "personal care" : "Haarpflege", 
            "air treatment" : "Luftbehandlung",
            "wearables" : "Kopfhörer",
            "lightning" : "Beleuchtung",
            "floor cleaners" : "Staubsauger"
        };
    }

    if (location.host.indexOf('.kr') > -1) {
        _dtag = 'kr';
        header = '최근 본 제품';
        header1 = '';
        see_more = '더 알아보기';
        reviewLang = 'Reviews';
        oosLocal = ' ';
        categoryValues = {
            "vacuum cleaners" : "vacuum cleaners",
            "personal care" : "hair care",
            "air treatment" : "air treatment",
            "wearables" : "headphones",
            "lightning" : "lightning",
            "floor cleaners" : "vacuum cleaners"
        };
    }

    if (location.pathname.indexOf('/vi-VN/') > -1) {
        header = 'Gợi ý dành cho bạn';
        header1 = '';
        see_more = 'Mua ngay';
        reviewLang = 'Reviews';
        oosLocal = ' ';
        categoryValues = {
            "vacuum cleaners" : "vacuum cleaners",
            "personal care" : "hair care",
            "air treatment" : "air treatment",
            "wearables" : "headphones",
            "lightning" : "lightning",
            "floor cleaners" : "vacuum cleaners"
        };
    }

    if (location.pathname.indexOf('/th-TH/') > -1) {
        header = 'สินค้าแนะนำสำหรับคุณ';
        header1 = '';
        see_more = 'เลือกซื้อ';
        reviewLang = 'Reviews';
        oosLocal = ' ';
        categoryValues = {
            "vacuum cleaners" : "vacuum cleaners",
            "personal care" : "hair care",
            "air treatment" : "air treatment",
            "wearables" : "headphones",
            "lightning" : "lightning",
            "floor cleaners" : "vacuum cleaners"
        };
    }

    if (location.pathname.indexOf('/ar-SA/') > -1) {
        header = 'الأكثر مبيعاً';
        header1 = '';
        see_more = 'تسوق الآن';
        reviewLang = 'Reviews';
        oosLocal = ' ';
        categoryValues = {
            "vacuum cleaners" : "vacuum cleaners",
            "personal care" : "hair care",
            "air treatment" : "air treatment",
            "wearables" : "headphones",
            "lightning" : "lightning",
            "floor cleaners" : "vacuum cleaners"
        };
    }

    if (location.pathname.indexOf('/ar-AE/') > -1) {
        header = 'الأكثر مبيعاً';
        header1 = '';
        see_more = 'تسوق الآن';
        reviewLang = 'Reviews';
        oosLocal = ' ';
        categoryValues = {
            "vacuum cleaners" : "vacuum cleaners",
            "personal care" : "hair care",
            "air treatment" : "air treatment",
            "wearables" : "headphones",
            "lightning" : "lightning",
            "floor cleaners" : "vacuum cleaners"
        };
    }

    if (location.host.indexOf('.tr') > -1) {
        _dtag = 'tr';
        header = 'Öne Çıkanlar';
        header1 = '';
        see_more = 'Satın al';
        reviewLang = 'Reviews';
        oosLocal = ' ';
        categoryValues = {
            "vacuum cleaners" : "vacuum cleaners",
            "personal care" : "hair care",
            "air treatment" : "air treatment",
            "wearables" : "headphones",
            "lightning" : "lightning",
            "floor cleaners" : "vacuum cleaners"
        };
    }

    if (location.host.indexOf('.pl') > -1) {
        _dtag = 'pl';
        header = 'Wyróżnione';
        header1 = '';
        see_more = 'Kup teraz';
        reviewLang = 'Reviews';
        oosLocal = ' ';
        categoryValues = {
            "vacuum cleaners" : "vacuum cleaners",
            "personal care" : "hair care",
            "air treatment" : "air treatment",
            "wearables" : "headphones",
            "lightning" : "lightning",
            "floor cleaners" : "vacuum cleaners"
        };
    }

    if (location.host.indexOf('.cz') > -1) {
        _dtag = 'cz';
        header = 'Doporučené';
        header1 = '';
        see_more = 'Nakupujte nyní';
        reviewLang = 'Reviews';
        oosLocal = ' ';
        categoryValues = {
            "vacuum cleaners" : "vacuum cleaners",
            "personal care" : "hair care",
            "air treatment" : "air treatment",
            "wearables" : "headphones",
            "lightning" : "lightning",
            "floor cleaners" : "vacuum cleaners"
        };
    }

    if (location.host.indexOf('.ro') > -1) {
        _dtag = 'ro';
        header = 'Recomandat';
        header1 = '';
        see_more = 'Cumpără acum';
        reviewLang = 'Reviews';
        oosLocal = ' ';
        categoryValues = {
            "vacuum cleaners" : "vacuum cleaners",
            "personal care" : "hair care",
            "air treatment" : "air treatment",
            "wearables" : "headphones",
            "lightning" : "lightning",
            "floor cleaners" : "vacuum cleaners"
        };
    }

    // Function to check if user has visited category pages (journey experience)
    var hasVisitedCategoryJourney = function() {
        // Check if user came from a category page (referrer check)
        var referrer = document.referrer;
        var categoryPaths = ['/staubsauger/', '/haarpflege/', '/raumklima/', '/kopfhoerer/', '/leuchten/', '/luftbehandlung/', '/beleuchtung/'];
        var hasReferrerFromCategory = categoryPaths.some(function(path) {
            return referrer.indexOf(path) > -1;
        });
        
        // Check for category visit cookie/localStorage
        var hasCategoryVisitCookie = false;
        try {
            hasCategoryVisitCookie = localStorage.getItem('dyson_category_visited') === 'true' || 
                                   document.cookie.indexOf('dyson_category_visited=true') > -1;
        } catch(e) {
            // Fallback if localStorage is not available
        }
        
        // Check if current page is a category page
        var currentPath = window.location.pathname;
        var isOnCategoryPage = categoryPaths.some(function(path) {
            return currentPath.indexOf(path) > -1;
        });
        
        // Check browser history for category visits (for back button scenarios)
        var hasHistoryFromCategory = false;
        try {
            // Check if we have navigation history indicating category visit
            if (window.performance && window.performance.navigation) {
                var navigationType = window.performance.navigation.type;
                // If user came via back button (type 2) and has category visit flag, consider it valid
                if (navigationType === 2 && hasCategoryVisitCookie) {
                    hasHistoryFromCategory = true;
                }
            }
        } catch(e) {
            // Fallback if performance API is not available
        }
        
        return hasReferrerFromCategory || hasCategoryVisitCookie || isOnCategoryPage || hasHistoryFromCategory;
    };

    // Function to set category visit flag
    var setCategoryVisitFlag = function() {
        try {
            localStorage.setItem('dyson_category_visited', 'true');
            // Also set a timestamp to track when the visit occurred
            localStorage.setItem('dyson_category_visited_time', Date.now().toString());
        } catch(e) {
            // Fallback to cookie if localStorage is not available
            document.cookie = 'dyson_category_visited=true; path=/; max-age=86400'; // 24 hours
        }
    };

    // Enhanced category detection for all category-related pages
    var checkAndSetCategoryFlag = function() {
        var currentPath = window.location.pathname.toLowerCase();
        var categoryPaths = ['/staubsauger/', '/haarpflege/', '/raumklima/', '/kopfhoerer/', '/leuchten/', '/luftbehandlung/', '/beleuchtung/'];
        
        // Check if current page is a category page or product page within a category
        var isOnCategoryRelatedPage = categoryPaths.some(function(path) {
            return currentPath.indexOf(path) > -1;
        });
        
        // Also check for product pages that might be category-related
        var productCategoryIndicators = ['/staubsauger', '/haarpflege', '/raumklima', '/kopfhoerer', '/leuchten', '/luftbehandlung', '/beleuchtung'];
        var isOnProductPage = productCategoryIndicators.some(function(indicator) {
            return currentPath.indexOf(indicator) > -1;
        });
        
        if (isOnCategoryRelatedPage || isOnProductPage) {
            setCategoryVisitFlag();
        }
    };

    // Set the flag if user is currently on a category-related page
    checkAndSetCategoryFlag();
    
    // Also listen for popstate events (back/forward button) to handle navigation
    window.addEventListener('popstate', function(event) {
        // Small delay to ensure page state is updated
        setTimeout(function() {
            checkAndSetCategoryFlag();
            // Re-evaluate header after back navigation
            updateHeaderAfterNavigation();
        }, 100);
    });
    
    // Function to update header after navigation events
    var updateHeaderAfterNavigation = function() {
        var headerEl = document.querySelector(".recs-container-T817 .trade-up-header__content");
        var firstCard = document.querySelector(".recs-container-T817 .at_recs_card");
        
        if (headerEl && firstCard) {
            if (firstCard.getAttribute("category") && hasVisitedCategoryJourney()) {
                // Show personalized category title for users who have visited category pages
                var category = firstCard.getAttribute("category").toLowerCase();
                var categoryText = categoryValues[category] || category;
                headerEl.innerHTML = header + ': ' + categoryText + header1;
                // Mark header as set by T817 to prevent other activities from overriding
                headerEl.setAttribute('data-t817-set', 'true');
            } else if (!headerEl.getAttribute('data-t817-set')) {
                // Show default title for first-time visitors (only if not already set)
                headerEl.innerHTML = header + header1;
                headerEl.setAttribute('data-t817-default', 'true');
            }
        }
    };
    
    // Also listen for pageshow event (handles back button cache scenarios)
    window.addEventListener('pageshow', function(event) {
        if (event.persisted) {
            // Page was loaded from cache (back button scenario)
            setTimeout(function() {
                checkAndSetCategoryFlag();
                updateHeaderAfterNavigation();
            }, 200);
        }
    });
    
    // Listen for visibility change (when page becomes visible again)
    document.addEventListener('visibilitychange', function() {
        if (!document.hidden) {
            // Page became visible again
            setTimeout(function() {
                checkAndSetCategoryFlag();
                updateHeaderAfterNavigation();
            }, 100);
        }
    });

    (function (w, d) {
        var logInfo = function (str) {
        }
        var Flickerlessly = w.Flickerlessly || {}; !function (t) { "use strict"; var e = function (t, e, n, o) { var a = "atNodeInserted" + t, i = [], s = ["", "-moz-", "-webkit-", "-ms-", "-o-"]; s.forEach(function (t, e) { i.push("@" + t + "keyframes " + a + " {from {opacity:0.99} to {opacity:1}}") }), i.push(e + "{"), s.forEach(function (t, e) { i.push(t + "animation-duration:0.001s;" + t + "animation-name:" + a + ";") }), i.push("}"); var r = d.getElementsByTagName("head")[0]; if (r) { var c = d.createElement("style"); c.setAttribute("type", "text/css"), c.styleSheet ? c.styleSheet.cssText = i.join("\n") : c.appendChild(d.createTextNode(i.join("\n"))), r.insertBefore(c, r.firstChild) } var l = function (t) { if (t.animationName === a && "object" == typeof t.target) { var i = o === !0 || o === !1 && null === t.target.getAttribute("data-flk-success"); w.console && logInfo("('" + e + "') ready! Execute: " + i, t.target), "function" == typeof n && i ? (n(t.target), t.target.setAttribute("data-flk-success", a)) : w.console && console.error("Cannot Callback", i, n) } };["animationstart", "MSAnimationStart", "webkitAnimationStart"].forEach(function (t, e) { d.addEventListener(t, l, !1) }) }, n = Math.floor(1e3 * Math.random() + 1); t.onReady = function () { for (var t = 0; t < arguments.length; t++) { var o = arguments[t], a = o.selector, i = o.success || null, s = o.persist || !1; e(n++, a, i, s) } } }(Flickerlessly);

/* change: reviews added as a selector */

        Flickerlessly.onReady(
            {
                selector: '.image-carousel.parbase:not(.at_target)',
                success: function (el) {
                   setTimeout(() => {
                      // Create container if it doesn't exist
                      var recsContainer = document.querySelector(".container-par.parbase.recs-container");
                      if(!recsContainer){
                          recsContainer = document.createElement('div');
                          recsContainer.className = 'container-par parbase recs-container';
                          el.parentNode.insertBefore(recsContainer, el.nextSibling);
                      }
                      
                      // Clear existing content and add new content
                      if(recsContainer){
                            $(recsContainer).find('div').remove();
                            el.className += ' at_target';
                            var recsContent = document.getElementById('at_template_recs_T817').innerHTML;
                            recsContainer.innerHTML = recsContent;
                            
                            // Set header content if cards exist - wait for cards to be fully rendered
                            setTimeout(function() {
                                var firstCard = document.querySelector(".recs-container-T817 .at_recs_card");
                                var headerEl = document.querySelector(".recs-container-T817 .trade-up-header__content");
                                if(firstCard && headerEl){
                                    if(firstCard.getAttribute("category") && hasVisitedCategoryJourney()){
                                        // Show personalized "Recommended [category] for you" title for users who have visited category pages
                                        var category = firstCard.getAttribute("category").toLowerCase();
                                        var categoryText = categoryValues[category] || category;
                                        if (typeof recommendedPrefix !== 'undefined' && typeof recommendedSuffix !== 'undefined') {
                                            headerEl.innerHTML = recommendedPrefix + ' ' + categoryText + ' ' + recommendedSuffix;
                                        } else {
                                            // Fallback to original format for non-German locales
                                            headerEl.innerHTML = header + ' ' + categoryText + header1;
                                        }
                                        // Mark header as set by T817 to prevent other activities from overriding
                                        headerEl.setAttribute('data-t817-set', 'true');
                                    } else {
                                        // Check if there's an existing title from previous activity
                                        var existingHeaderEl = document.querySelector('.recs-container h2.trade-up-header__content.js-trade-up-header-content');
                                        var fallbackTitle = 'Deine Black Friday Highlights';
                                        
                                        if (existingHeaderEl && existingHeaderEl.innerHTML.trim() !== '') {
                                            // Use title from previous activity
                                            headerEl.innerHTML = existingHeaderEl.innerHTML;
                                            headerEl.setAttribute('data-t707', 'true');
                                        } else {
                                            // Use fallback title if no previous activity set it
                                            headerEl.innerHTML = fallbackTitle;
                                            headerEl.setAttribute('data-t817-default', 'true');
                                        }
                                    }
                                }
                            }, 300);
                            
                            // Make sure the container is visible
                            recsContainer.style.display = 'block';
                            recsContainer.style.visibility = 'visible';
                      }                       
                    }, 100);
                    
                },
                persist: true
            },
            {
                selector: 'body:not(.at_recs_loaded)',
                success: function (el) {
                    setTimeout(() => {
                        // Only run if we haven't already loaded recommendations
                        if(document.querySelector('.at_recs_card')) return;
                        
                        // Find a suitable insertion point
                        var insertionPoint = document.querySelector('.image-carousel.parbase') || 
                                           document.querySelector('.container-par.parbase') ||
                                           document.querySelector('main') ||
                                           document.querySelector('.content') ||
                                           document.body;
                        
                        if(insertionPoint){
                            // Create container
                            var recsContainer = document.createElement('div');
                            recsContainer.className = 'container-par parbase recs-container';
                            recsContainer.innerHTML = document.getElementById('at_template_recs_T817').innerHTML;
                            
                            // Insert after the insertion point
                            if(insertionPoint.parentNode){
                                insertionPoint.parentNode.insertBefore(recsContainer, insertionPoint.nextSibling);
                            } else {
                                insertionPoint.appendChild(recsContainer);
                            }
                            
                            // Set header content if cards exist
                            var firstCard = document.querySelector(".recs-container-T817 .at_recs_card");
                            var headerEl = document.querySelector(".recs-container-T817 .trade-up-header__content");
                            if(firstCard && headerEl){
                                if(firstCard.getAttribute("category") && hasVisitedCategoryJourney()){
                                    // Show personalized "Recommended [category] for you" title for users who have visited category pages
                                    var category = firstCard.getAttribute("category").toLowerCase();
                                    var categoryText = categoryValues[category] || category;
                                    if (typeof recommendedPrefix !== 'undefined' && typeof recommendedSuffix !== 'undefined') {
                                        headerEl.innerHTML = recommendedPrefix + ' ' + categoryText + ' ' + recommendedSuffix;
                                    } else {
                                        // Fallback to original format for non-German locales
                                        headerEl.innerHTML = header + ' ' + categoryText + header1;
                                    }
                                    // Mark header as set by T817 to prevent other activities from overriding
                                    headerEl.setAttribute('data-t817-set', 'true');
                                } else {
                                    // Check if there's an existing title from previous activity
                                    var existingHeaderEl = document.querySelector('.recs-container h2.trade-up-header__content.js-trade-up-header-content');
                                    var fallbackTitle = 'Deine Black Friday Highlights';
                                    
                                    if (existingHeaderEl && existingHeaderEl.innerHTML.trim() !== '') {
                                        // Use title from previous activity
                                        headerEl.innerHTML = existingHeaderEl.innerHTML;
                                        headerEl.setAttribute('data-t707', 'true');
                                    } else {
                                        // Use fallback title if no previous activity set it
                                        headerEl.innerHTML = fallbackTitle;
                                        headerEl.setAttribute('data-t817-default', 'true');
                                    }
                                }
                            }
                            
                            // Mark as loaded
                            document.body.classList.add('at_recs_loaded');
                            
                            // Make sure the container is visible
                            recsContainer.style.display = 'block';
                            recsContainer.style.visibility = 'visible';
                        }
                    }, 200);
                },
                persist: true
            },
            {
                selector: ".at_recs_card .at_recs_price > .atBluePrice",
                success: function (el) {
                    el=el.querySelector('.trade-up-item__price--blue');
                    el = el.parentNode.querySelector('.trade-up-item__reduced-price');
                   
					 setTimeout(function () {
							matchHeight();
							addPriceHeight();
						}, 500);
                },
                persist: true
            },
            {
                selector: ".at_recs_card ",
                success: function (el) {
                    var domain = el.getAttribute('region'), sku = el.getAttribute('sku'), base_url = '', rating='';
                    if (domain === 'ca') {
                        base_url = 'https://api.dyson.co.uk/apiman-gateway/dyson/product/1.0/ca/';
                    } else if (domain === 'us') {
                        base_url = 'https://api.dyson.com/apiman-gateway/dyson/product/1.0/us/';
                    } else if(domain === 'uk') {
						base_url = 'https://api.dyson.com/apiman-gateway/dyson/product/1.0/gb/';
					}
                    else if (domain === window._dtag) {
                        base_url = 'https://api.dyson.co.uk/apiman-gateway/dyson/product/1.0/' + window._dtag + '/';
                    }
					//rating = el.querySelector('review_stars').innerHTML;
                    fetchRating(base_url, sku.replace(window._dtag.toUpperCase(), ""), domain, rating);

                    el.querySelector('.see-more-section span').innerHTML = see_more;
					

                    if (document.querySelector('.recs-container h2.trade-up-header__content.hidden-xs-up')) {
                        /* change 4 starts : added message for oos products */
                        var oosMessage = "";
                        if (document.querySelector(".sticky-nav__button .button--notifyMe") != null) {
                            oosMessage = oosLocal;
                        }
                        /* change 4 ends : added oos message in next line (530) for oos products */
                        document.querySelector('.recs-container h2.trade-up-header__content.hidden-xs-up')
                        .innerHTML = header + oosMessage;;
                        document.querySelector('.recs-container h2.trade-up-header__content')
                        .className = 'trade-up-header__content js-trade-up-header-content col-xs-12';
                    }
                },
                persist: true
            },
			    {
				selector: '.recs_wrapper.carousel',
                success: function (el) {
					if (window.innerWidth < 500) {
					setInterval(loadCarousel, 1000);
							}
                },
                persist: true
            });
        var fetchRating = function (base_url, sku, domain, rating) {
			sku=sku.replace("US", "").replace("GB", "").replace("CA", "").replace('BE','').replace('CH','');
            var xhttp = new XMLHttpRequest();
            var id = sku + window._dtag.toUpperCase();
			if(domain=='jp') {
				id = sku;
			}
			if(domain=='at') {
				let ratings = document.querySelector('.at_recs_card[sku="' + id + '"] .reviews_section .review_stars').innerHTML;
				document.querySelector('.at_recs_card[sku="' + id + '"] .reviews_section .review_stars').innerHTML = '';
				let stars = "";
				if (Number(ratings) >= 5) {
                                stars = 'five'
                            } else if (Number(ratings) >= 4.5) {
                                stars = 'four-five'
                            } else if (Number(ratings) >= 4) {
                                stars = 'four';
                            } else if (Number(ratings) >= 3.5) {
                                stars = 'three-five';
                            } else if (Number(ratings) >= 3) {
                                stars = 'three';
                            } else if (Number(ratings) >= 2.5) {
                                stars = 'two-five';
                            } else if (Number(ratings) >= 2) {
                                stars = 'two';
                            } else if (Number(ratings) >= 1.5) {
                                stars = 'one-five';
                            } else if (Number(ratings) >= 1) {
                                stars = 'one';
                            } else if (Number(ratings) < 1) {
                                stars = 'zero';
                            }
				 let prodName = document.querySelector('.at_recs_card[sku="' + id + '"] .text_section h3').textContent;
							document.querySelector('.at_recs_card[sku="' + id + '"] .reviews_section .review_stars').className += (' ' + stars);
                            document.querySelector('.at_recs_card[sku="' + id + '"] img.at-thumbnail').setAttribute('alt', prodName);
							return;
			}
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    try {
                        var res = JSON.parse(this.responseText),
                            ratings = res['bazaarVoiceAverageRating'],
                            reviews = res["bazaarVoiceNumberOfReviews"],
                            hideWasNowPricing = res["hideWasNowPricing"];
                        if (id && document.querySelector('.at_recs_card[sku="' + id + '"] .reviews_section')) {
                            var stars = "";
                            if (hideWasNowPricing) {
                                document.querySelector('.at_recs_card[sku="' + id + '"]').setAttribute('hidewasnowpricing', true);
                            }

                            if (isNaN(Number(ratings))) {
									stars = 'zero';
                            }
                            if (Number(ratings) >= 5) {
                                stars = 'five'
                            } else if (Number(ratings) >= 4.5) {
                                stars = 'four-five'
                            } else if (Number(ratings) >= 4) {
                                stars = 'four';
                            } else if (Number(ratings) >= 3.5) {
                                stars = 'three-five';
                            } else if (Number(ratings) >= 3) {
                                stars = 'three';
                            } else if (Number(ratings) >= 2.5) {
                                stars = 'two-five';
                            } else if (Number(ratings) >= 2) {
                                stars = 'two';
                            } else if (Number(ratings) >= 1.5) {
                                stars = 'one-five';
                            } else if (Number(ratings) >= 1) {
                                stars = 'one';
                            } else if (Number(ratings) < 1) {
                                stars = 'zero';
                            }

                            /* change 2: fetched product name */
                            var prodName = document.querySelector('.at_recs_card[sku="' + id + '"] .text_section h3').textContent;
							document.querySelector('.at_recs_card[sku="' + id + '"] .reviews_section .review_stars').className += (' ' + stars);
							if(reviews != undefined) {
                            document.querySelector('.at_recs_card[sku="' + id + '"] .reviews_section .review_stars').setAttribute('ratings', ratings);
                            
                            document.querySelector('.at_recs_card[sku="' + id + '"] .reviews_section .review_text').innerHTML = reviews; 
                            document.querySelector('.at_recs_card[sku="' + id + '"] .reviews_section').removeAttribute('style');

                            /* change 3: added next three lines for accessibility div */
                            document.querySelector('.at_recs_card[sku="' + id + '"] .reviews_section .sr-only.ratings__stars--reader').textContent = ratings + ' stars out of 5 from ' + reviews + ' Reviews';
                            document.querySelector('.at_recs_card[sku="' + id + '"] img.at-thumbnail').setAttribute('alt', prodName);
							}
                        } else {
                        }
                    } catch (err) {

                    }
                }
            };
            xhttp.open("GET", base_url + sku, true);
            xhttp.send();
        }

    
    // Add protection against header being overridden by other activities
    var protectT817Header = function() {
        var headerEl = document.querySelector(".recs-container-T817 .trade-up-header__content");
        if (headerEl && headerEl.getAttribute('data-t817-set') === 'true') {
            var originalContent = headerEl.innerHTML;
            
            // Create a MutationObserver to watch for changes
            var observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'childList' || mutation.type === 'characterData') {
                        // If content changed and it's not our content, restore it
                        if (headerEl.innerHTML !== originalContent && headerEl.getAttribute('data-t817-set') === 'true') {
                            headerEl.innerHTML = originalContent;
                        }
                    }
                });
            });
            
            // Start observing
            observer.observe(headerEl, {
                childList: true,
                subtree: true,
                characterData: true
            });
            
            // Also set up a periodic check as backup
            setInterval(function() {
                if (headerEl && headerEl.getAttribute('data-t817-set') === 'true' && headerEl.innerHTML !== originalContent) {
                    headerEl.innerHTML = originalContent;
                }
            }, 1000);
        }
    };
    
    // Start protection after a delay to ensure header is set first
    setTimeout(protectT817Header, 1000);

    })(window, document);
</script></div></div>
